%% LaTeX2e class for student theses
%% sections/apendix.tex
%% 
%% Karlsruhe Institute of Technology
%% Institute for Program Structures and Data Organization
%% Chair for Software Design and Quality (SDQ)
%%
%% Dr.-Ing. Erik Burger
%% burger@kit.edu
%%
%% Version 1.3.3, 2018-04-17

\iflanguage{english}
{\chapter{Appendix}}    % english style
{\chapter{Anhang}}      % german style
\label{chap:appendix}

\section{A Note on Orthography}

Throughout this thesis,
the words “\gls{item}”, “\gls{property}”,
“\gls{label}”, “\gls{description}”, “\gls{alias}”,
“\gls{sitelink}”,
“\gls{statement}”, “\gls{qualifier}” and “\gls{reference}”
are capitalized as proper nouns when referring to elements of the \gls{Wikidata} data model,
following a common (though not universal) convention in the \gls{Wikidata} community,
and the word “\gls{schema}” is pluralized into “\glspl{schema}”
rather than “schemata”
for consistency with other \gls{shex} texts \cite{shex,shex-primer}.

\section{Results of Validation With Depth Limit}
\label{sec:appendix:depth-limit}

The following tables show the results
when attempting various validations against inferred \glspl{schema}
with different depth limits.
The meaning of the result column is as follows:

\begin{description}
\item[solved] validation completed successfully (found a solution)
\item[fail] validation completed unsuccessfully (reported violations)
\item[limit] the result is directly “depth limit reached” % TODO perhaps just remove these lines?
\item[core] the process crashed and dumped core (out-of-memory error)
\item[abort] the process was manually killed after a long time with no apparent progress
\end{description}

\begin{table}[ht]
  \centering
  \begin{tabular}{r r r l}
    limit & real time & CPU time & result \\
    \hline
    - & \minsec{2}{50} & \minsec{8}{51} & core \\
    1 & \minsec{0}{0} & \minsec{0}{0} & limit \\
    2 & \minsec{4}{41} & \minsec{17}{22} & core \\
    3 & \minsec{3}{57} & \minsec{13}{31} & core \\
    4 & \minsec{2}{51} & \minsec{9}{1} & core \\
    5 & \minsec{2}{48} & \minsec{8}{54} & core \\
    6 & \minsec{2}{50} & \minsec{8}{58} & core \\
    7 & \minsec{2}{48} & \minsec{8}{41} & core \\
    8 & \minsec{2}{47} & \minsec{8}{44} & core \\
    9 & \minsec{2}{48} & \minsec{8}{48} & core \\
    10 & \minsec{2}{48} & \minsec{8}{53} & core
  \end{tabular}
  \caption{
    Results when validating the \gls{item} \QL{Q44578}{Titanic}
    against the \gls{shape} for the class \QL{Q11424}{film}
    from a \gls{schema} inferred from the set of films that won ten or more Oscars
    (\wdsiJob{29})
  }
  \label{tab:appendix:depth-limit:1}
\end{table}

\begin{table}[ht]
  \centering
  \begin{tabular}{r r r l}
    limit & real time & CPU time & result \\
    \hline
    - & \minsec{0}{1} & \minsec{0}{3} & fail \\
    1 & \minsec{0}{0} & \minsec{0}{0} & limit \\
    2 & \minsec{0}{16} & \minsec{0}{21} & core \\
    3 & \minsec{0}{1} & \minsec{0}{2} & fail \\
    4 & \minsec{0}{1} & \minsec{0}{3} & fail \\
    5 & \minsec{0}{1} & \minsec{0}{3} & fail \\
    6 & \minsec{0}{1} & \minsec{0}{3} & fail \\
    7 & \minsec{0}{1} & \minsec{0}{3} & fail \\
    8 & \minsec{0}{1} & \minsec{0}{2} & fail \\
    10 & \minsec{0}{1} & \minsec{0}{3} & fail
  \end{tabular}
  \caption{
    Results when validating the \gls{item} \QL{Q42}{Douglas Adams}
    against the \gls{shape} for the class \QL{Q5}{human}
    from a \gls{schema} inferred from the set of films that won ten or more Oscars
    (\wdsiJob{29})
  }
  \label{tab:appendix:depth-limit:2}
\end{table}

\begin{table}[ht]
  \centering
  \begin{tabular}{r r r l}
    limit & real time & CPU time & result \\
    \hline
    - & \minsec{0}{17} & \minsec{0}{7} & fail \\
    1 & \minsec{0}{0} & \minsec{0}{0} & limit \\
    2 & \minsec{0}{0} & \minsec{0}{1} & solved \\
    3 & \minsec{0}{18} & \minsec{0}{7} & fail \\
    4 & \minsec{0}{19} & \minsec{0}{8} & fail \\
    5 & \minsec{0}{17} & \minsec{0}{7} & fail \\
    6 & \minsec{0}{18} & \minsec{0}{8} & fail \\
    7 & \minsec{0}{18} & \minsec{0}{8} & fail \\
    8 & \minsec{0}{18} & \minsec{0}{8} & fail \\
    9 & \minsec{0}{18} & \minsec{0}{7} & fail \\
    10 & \minsec{0}{18} & \minsec{0}{7} & fail
  \end{tabular}
  \caption{
    Results when validating the \gls{item} \QL{Q42}{Douglas Adams}
    against the \gls{shape} for the class \QL{Q5}{human}
    from a \gls{schema} inferred from the members of the 13th Riigikogu
    (the Estonian parliament; \wdsiJob{30})
  }
  \label{tab:appendix:depth-limit:3}
\end{table}

\begin{table}[ht]
  \centering
  \begin{tabular}{r r r l}
    limit & real time & CPU time & result \\
    \hline
    - & \minsec{2}{50} & \minsec{8}{51} & core \\
    1 & \minsec{0}{0} & \minsec{0}{0} & limit \\
    2 & \minsec{4}{41} & \minsec{17}{22} & core \\
    3 & \minsec{3}{57} & \minsec{13}{31} & core \\
    4 & \minsec{2}{51} & \minsec{9}{1} & core \\
    5 & \minsec{2}{48} & \minsec{8}{54} & core \\
    6 & \minsec{2}{50} & \minsec{8}{58} & core \\
    7 & \minsec{2}{48} & \minsec{8}{41} & core \\
    8 & \minsec{2}{47} & \minsec{8}{44} & core \\
    9 & \minsec{2}{48} & \minsec{8}{48} & core \\
    10 & \minsec{2}{48} & \minsec{8}{53} & core
  \end{tabular}
  \caption{
    Results when validating the \gls{item} \QL{Q449851}{Mailis Reps}
    against the \gls{shape} for the class \QL{Q5}{human}
    from a \gls{schema} inferred from the members of the 13th Riigikogu
    (\wdsiJob{30})
  }
  \label{tab:appendix:depth-limit:4}
\end{table}

\begin{table}[ht]
  \centering
  \begin{tabular}{r r r l}
    limit & real time & CPU time & result \\
    \hline
    - & \minsec{1}{25} & \minsec{4}{14} & core \\
    1 & \minsec{0}{1} & \minsec{0}{1} & limit \\
    2 & \minsec{0}{1} & \minsec{0}{1} & fail \\
    3 & \minsec{0}{55} & \minsec{2}{6} & core \\
    4 & \minsec{7}{34} & 1\minsec{3}{54} & core \\
    5 & \minsec{0}{10} & \minsec{0}{27} & core \\
    6 & \minsec{0}{30} & \minsec{1}{5} & core \\
    7 & \minsec{0}{51} & \minsec{1}{59} & core \\
    8 & \minsec{5}{29} & 1\minsec{2}{54} & core \\
    9 & \minsec{0}{9} & \minsec{0}{19} & core \\
    10 & 8\minsec{6}{39} & 15\minsec{3}{35} & abort
  \end{tabular}
  \caption{
    Results when validating the \gls{item} \QL{Q30}{United States of America}
    against the \gls{shape} for the class \QL{Q3624078}{sovereign state}
    from a \gls{schema} inferred from a set of \glspl{item} for bus stops
    (\wdsiJob{15})
  }
  \label{tab:appendix:depth-limit:5}
\end{table}

\section{Job Execution Times}
\label{sec:jobs-over-various}

The following charts show the total execution time of the inference process
for various input queries collected from the \gls{wdsi}:

\begin{itemize}
\item Members of the 30th Riigikogu (the Estonian parliament),
  limited to 50 \glspl{item}.
  Originally \wdsiJob{30}.
\item The Federal Chancellors of Germany,
  originally \wdsiJob{1}.
\item Films that won three or more Academy Awards (“Oscars”). % glossary? ™?
  Originally \wdsiJob{32}, later repeated as \wdsiJob{34}, \wdsiJob{35}, \wdsiJob{36}.
  (Some earlier jobs used a similar query with a limit of ten or five Oscars.)
\item The human \glspl{item} with most \glspl{sitelink} to other \gls{Wikimedia} projects
  (including but not limited to \gls{Wikipedia} articles in different language editions),
  limited to 50 \glspl{item}.
  Originally \wdsiJob{24}, later repeated as \wdsiJob{26}, \wdsiJob{27}.

  This is one of the two outliers removed for the first version of each chart,
  since it has an unusually high execution time compared to the amount of input data.
  My best explanation for that is that this is a less “coherent” set of \glspl{item}:
  since the selection criterion (the number of sitelinks) is not directly related to the data,
  this includes politicians, authors, religious figures, scientists, philosophers, celebrities, composers, and other kinds of people
  (though none of these are \emph{classes} in the sense relevant to \gls{RDF2Graph}).
\item The largest cities in the world by population,
  limited to 25 \glspl{item}.
  Originally \wdsiJob{3}.
\item Mammal taxa (including species but also genera, families etc.).
  Limited to \num{20000} \glspl{item},
  a limit that was experimentally determined to produce a high but not exorbitant number of triples.
  Originally \wdsiJob{33}.

  This is the second of the two outliers removed for the first version of each chart,
  due to the absurd number of input \glspl{item}:
  compare especially the $X$-axes of
  \cref{fig:jobs-over-entities-with-outliers,fig:jobs-over-entities-without-outliers}.
\item Programming languages with the highest number of \glspl{statement},
  limited to 50 \glspl{item}.
  Originally \wdsiJob{17}, later repeated as \wdsiJob{18}.
\item Recently edited \glspl{item} for \glspl{rfc},
  limited to 500 \glspl{item}.
  Originally \wdsiJob{21}, based on the earlier \wdsiJob{20} (equivalent but with a lower limit),
  which in turn was inspired by \wdsiJob{8}.
\item The member states of the United Nations,
  originally \wdsiJob{23}.
\item The presidents of the United States of America,
  originally \wdsiJob{2}.
\item The chapter organizations of the \gls{Wikimedia Foundation},
  originally \wdsiJob{5}.
\end{itemize}

For each input query,
the different steps of the inference process
(data download, initial \gls{RDF2Graph} run, \gls{RDF2Graph} simplification, \gls{shex} export)
were timed individually,
recording the real (“wall-clock”) time, user CPU time and system CPU time separately.
Only the sum of the real time was used for the charts below,
but the full data is available in the source code repository for this thesis.
% TODO okay to mention the repository? if yes, dump its url somewhere!
All the steps were performed on a system
with an Intel® Core™ i7-4771 CPU (\SI{3.50}{\giga\hertz} clock rate),
ca. \SI{25.2}{\giga\byte} (\SI{23.5}{\gibi\byte}) of memory,
and a network connection allowing download rates of up to \SI{23.6}{\mebi\byte\per\second} from \gls{wdqs},
with no significant other load of any kind at the time of measurement.

In addition to the graphs shown here,
the full data also shows that the simplification step of the process
never takes more than a minute,
which means that while the changes in \cref{sec:RDF2Graph+Wikidata:cyclic-graphs} potentially slowed this step down to some degree,
it does not make a big difference for the total execution time,
which is mostly dominated by other steps
(\gls{RDF2Graph} without simplification and \gls{shex} export)
anyways.

\begin{figure}[ht]
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-over-entities}
    \caption{Job execution time over number of \glspl{item}, with outliers}
    \label{fig:jobs-over-entities-with-outliers}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-without-outliers-over-entities}
    \caption{Job execution time over number of \glspl{item}, without outliers}
    \label{fig:jobs-over-entities-without-outliers}
  \end{subfigure}
  \caption{Job execution time over number of \glspl{item} selected by the query}
  \label{fig:jobs-over-entities}
\end{figure}

\begin{figure}[ht]
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-over-triples}
    \caption{Job execution time over number of \glspl{triple}, with outliers}
    \label{fig:jobs-over-triples-with-outliers}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-without-outliers-over-triples}
    \caption{Job execution time over number of \glspl{triple}, without outliers}
    \label{fig:jobs-over-triples-without-outliers}
  \end{subfigure}
  \caption{Job execution time over number of \glspl{triple} in the input data set}
  \label{fig:jobs-over-triples}
\end{figure}

\begin{figure}[ht]
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-over-P31s}
    \caption{Job execution time over number of \PName{wdt:P31} \glspl{triple}, with outliers}
    \label{fig:jobs-over-P31s-with-outliers}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-without-outliers-over-P31s}
    \caption{Job execution time over number of \PName{wdt:P31} \glspl{triple}, without outliers}
    \label{fig:jobs-over-P31s-without-outliers}
  \end{subfigure}
  \caption{Job execution time over number of \PName{wdt:P31} \glspl{triple} in the input data set}
  \label{fig:jobs-over-P31s}
\end{figure}

\begin{figure}[ht]
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-over-classes}
    \caption{Job execution time over number of classes, with outliers}
    \label{fig:jobs-over-classes-with-outliers}
  \end{subfigure}
  \begin{subfigure}{\textwidth}
    \centering
    \input{graphs/jobs-without-outliers-over-classes}
    \caption{Job execution time over number of classes, without outliers}
    \label{fig:jobs-over-classes-without-outliers}
  \end{subfigure}
  \caption{Job execution time over number of distinct classes in the input data set}
  \label{fig:jobs-over-classes}
\end{figure}
